<div class="max-h-0 overflow-hidden pt-1 transition-all duration-500 ease-out ltr:pl-4 rtl:pr-4"
    [ngClass]="{ hidden: !menuService.showSideBar, 'max-h-screen': submenu().expanded }">
    <ul class="border-border text-muted-foreground flex flex-col border-dashed ltr:border-l ltr:pl-2 rtl:border-r rtl:pr-2 relative">
        
        <!-- Animated border line -->
        <div class="absolute top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-primary/40 to-transparent ltr:left-0 rtl:right-0 opacity-0 scale-y-0 transition-all duration-700 ease-out origin-top"
             [ngClass]="{ 'opacity-100 scale-y-100': submenu().expanded }">
        </div>
        
        @for (sub of submenu().children; track $index) {
        <li class="transform transition-all duration-300 ease-out"
            [style.transition-delay]="($index * 50) + 'ms'"
            [ngClass]="{
                'translate-x-0 opacity-100': submenu().expanded,
                'translate-x-4 opacity-0': !submenu().expanded
            }">
            <div class="text-muted-foreground hover:text-primary relative flex group transition-all duration-300 ease-out hover:bg-card/30 rounded-lg"
                 (click)="toggleMenu(sub)">
                
                <!-- Hover indicator -->
                <div class="absolute left-0 top-1/2 -translate-y-1/2 w-0.5 h-0 bg-primary transition-all duration-300 ease-out group-hover:h-6 ltr:-ml-2 rtl:-mr-2">
                </div>
                
                <!-- Condition -->
                <ng-container [ngTemplateOutlet]="sub.children ? childMenu : parentMenu"
                    [ngTemplateOutletContext]="{ sub: sub }">
                </ng-container>
                
                <!-- Parent Menu -->
                <ng-template #parentMenu let-sub="sub">
                    <a [routerLink]="sub.route" routerLinkActive="text-primary"
                        [routerLinkActiveOptions]="{ exact: true }"
                        class="hover:bg-card inline-block w-full rounded-lg px-4 py-2 text-xs transition-all duration-300 ease-out transform hover:translate-x-1">
                        {{ sub.label }}
                    </a>
                    @if(menuService.isActive(sub.route)){
                    <span class="size-1.5 bg-primary absolute flex translate-y-3.5 items-center rounded-full ltr:-translate-x-[11.5px] rtl:translate-x-[11.5px] animate-pulse">
                    </span>
                    }
                </ng-template>

                <!-- Child Menu -->
                <ng-template #childMenu let-sub="sub">
                    <a class="inline-block w-full cursor-pointer px-4 py-2 text-xs transition-all duration-300 ease-out transform hover:translate-x-1">
                        {{ sub.label }}
                    </a>
                    <button [ngClass]="{ hidden: !menuService.showSideBar }"
                        class="text-foreground/50 hover:text-primary flex cursor-pointer items-center justify-end px-2 transition-all duration-500 ease-out transform hover:scale-110">
                        <div class="transition-all duration-300 ease-out"
                             [ngClass]="{
                                'rotate-45': sub.expanded,
                                'rotate-0': !sub.expanded
                             }">
                            @if(!sub.expanded){
                            <svg-icon src="icons/heroicons/outline/plus.svg" svgClass="h-4 w-4"></svg-icon>
                            }@else {
                            <svg-icon src="icons/heroicons/outline/minus.svg" svgClass="h-4 w-4"></svg-icon>
                            }
                        </div>
                    </button>
                </ng-template>
            </div>
            
            <!-- Submenu items -->
            @if(sub.children?.length){
            <div class="transition-all duration-500 ease-out"
                 [ngClass]="{
                    'max-h-96 opacity-100': sub.expanded,
                    'max-h-0 opacity-0': !sub.expanded
                 }">
                <app-sidebar-submenu [submenu]="sub"></app-sidebar-submenu>
            </div>
            }
        </li>
        }
    </ul>
</div>